<!DOCTYPE html>
<html>
<head>
    <title>{{ title }}</title>
    <style>
        body {
            background: linear-gradient(120deg, #1e3c72, #2a5298);
            color: white;
            text-align: center;
            padding-top: 100px;
            font-family: system-ui, sans-serif;
        }
    </style>
</head>
<body>
    <h2>Lade Dashboard...</h2>
    <p>Wenn diese Meldung länger bleibt, ist der Token ungültig.</p>
    
    <script>
        const token = localStorage.getItem('access_token');

        if (!token) {
            // Wenn kein Token vorhanden ist, zurück zur Anmeldeseite
            window.location.href = "/"; 
        } else {
            // Führt einen geschützten Fetch-Aufruf zum Backend durch
            fetch('/dashboard', {
                headers: {
                    // Der Token wird im HTTP-Header gesendet, damit das Backend ihn prüfen kann
                    'Authorization': `Bearer ${token}` 
                }
            })
            .then(response => {
                if (response.ok) {
                    // Wenn der Aufruf erfolgreich ist (Code 200), lädt er den HTML-Inhalt des Dashboards
                    return response.text();
                } else if (response.status === 401 || response.status === 403) {
                    // Token ungültig/abgelaufen oder Konto unverifiziert
                    localStorage.removeItem('access_token');
                    window.location.href = "/";
                } else {
                    throw new Error('Fehler beim Laden des Dashboards');
                }
            })
            .then(html => {
                // Ersetzt den gesamten HTML-Inhalt der Seite durch den Dashboard-Inhalt
                document.open();
                document.write(html);
                document.close();
            })
            .catch(error => {
                console.error('Ladefehler:', error);
                alert('Dashboard konnte nicht geladen werden. Bitte erneut einloggen.');
                localStorage.removeItem('access_token');
                window.location.href = "/";
            });
        }
    </script>
</body>
</html>