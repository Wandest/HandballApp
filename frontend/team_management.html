<style>
    /* ================================================== */
    /* STYLES HIER BEHALTEN */
    /* ================================================== */
    .player-list-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .player-list-item:last-child {
        border-bottom: none;
    }
    .player-info {
        flex-grow: 1;
    }
    .player-actions .btn {
        margin-top: 0;
        margin-left: 5px;
        padding: 5px 10px; /* Kleinere Buttons */
        font-size: 0.9em;
    }
    
    /* Status-Text (z.B. "Aktiv" oder "Eingeladen") */
    .account-status {
        font-size: 0.9em;
        font-weight: bold;
        margin-right: 10px;
        padding: 4px 8px;
        border-radius: 4px;
        white-space: nowrap;
    }
    .account-status.active {
        color: #1e3c72;
        background-color: #38E838; /* Gr√ºn */
    }
    .account-status.pending {
        color: #333;
        background-color: #ffcc00; /* Gelb */
    }

    /* NEU (PHASE 10.2): Staff Management Styles */
    .staff-management-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }
    #staff-list-container {
        max-height: 300px;
        overflow-y: auto;
    }
    .staff-list-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: rgba(0,0,0,0.2);
        padding: 10px;
        border-radius: 4px;
        margin-bottom: 5px;
    }
    .staff-list-item .staff-role {
        font-size: 0.9em;
        opacity: 0.8;
    }
    /* Modal Styles f√ºr Rollen-Update */
    #role-change-modal .modal-content {
        max-width: 500px;
    }
    #new-role-select-swap, #new-role-select-update {
        width: 100%;
        padding: 10px;
        margin-bottom: 5px;
        box-sizing: border-box;
        border-radius: 5px;
        background: #f0f0f0;
        color: #333;
    }
    
    /* NEU: Styles f√ºr Settings Card */
    .settings-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
    }

    /* +++ NEU (PHASE 11): INJURY STYLES +++ */
    #injury-modal .modal-content {
        max-width: 800px;
    }
    .injury-layout {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-top: 15px;
    }
    #injury-history-list {
        max-height: 400px;
        overflow-y: auto;
        background: rgba(0,0,0,0.1);
        border-radius: 5px;
        padding: 10px;
    }
    .injury-item {
        background: rgba(255, 255, 255, 0.1);
        padding: 12px;
        border-radius: 5px;
        margin-bottom: 8px;
        border-left: 4px solid #ccc;
    }
    .injury-item.status-ACUTE { border-left-color: #f44336; } /* Rot */
    .injury-item.status-CHRONIC { border-left-color: #ff9800; } /* Orange */
    .injury-item.status-REHAB { border-left-color: #ffcc00; } /* Gelb */
    .injury-item.status-CLEARED { border-left-color: #38E838; opacity: 0.7; } /* Gr√ºn */
    
    .injury-header {
        display: flex;
        justify-content: space-between;
        font-weight: bold;
        margin-bottom: 5px;
    }
    .injury-dates {
        font-size: 0.85em;
        opacity: 0.8;
    }
    .injury-actions {
        margin-top: 8px;
        text-align: right;
    }
    .btn-small {
        padding: 4px 8px;
        font-size: 0.85em;
        margin-top: 0;
    }

</style>

<div class="management-grid">
    <div class="card">
      <div class="card-content">
        <h2>Mannschaft hinzuf√ºgen</h2>
        <form id="add-team-form">
            <label for="team-name">Name der Mannschaft:</label>
            <input type="text" id="team-name" required><br>
            <label for="team-league">Spielklasse / Liga:</label>
            <select id="team-league" required>
                <option value="" disabled selected>W√§hlen Sie eine Klasse</option>
                {% for league in leagues %}
                    <option value="{{ league }}">{{ league }}</option>
                {% endfor %}
            </select><br>
            <button type="submit" class="btn btn-primary">Mannschaft erstellen</button>
        </form>
        <div id="team-message" class="message"></div>
      </div>
    </div>
    
    <div class="card">
        <div class="card-content">
            <h2>Spieler hinzuf√ºgen</h2>
            <h3><span id="kader-team-name-form" style="color: #00bcd4;">(Team w√§hlen)</span></h3>
            <form id="add-player-form">
                <label for="player-name">Spielername:</label>
                <input type="text" id="player-name" required><br>
                <label for="player-number">Trikotnummer (optional):</label>
                <input type="number" id="player-number" min="1" max="99"><br>
                <label for="player-position">Position (optional):</label>
                <select id="player-position">
                    <option value="">(Keine Position)</option>
                    {% for position in positions %}
                        <option value="{{ position }}">{{ position }}</option>
                    {% endfor %}
                </select><br>
                <button type="submit" class="btn btn-primary" id="add-player-button" disabled>Spieler hinzuf√ºgen</button>
            </form>
            <div id="player-message" class="message"></div>
        </div>
    </div>

    <div class="card">
        <div class="card-content">
            <h2>Aktionen erstellen</h2>
            <h3><span id="custom-action-team-name-form" style="color: #00bcd4;">(Team w√§hlen)</span></h3>
            <form id="add-custom-action-form">
                <label for="custom-action-name">Name der Aktion:</label>
                <input type="text" id="custom-action-name" required><br>
                <label for="custom-action-category">Kategorie:</label>
                <select id="custom-action-category">
                    {% for category in action_categories %}
                        <option value="{{ category }}">{{ category }}</option>
                    {% endfor %}
                </select><br>
                <button type="submit" class="btn btn-primary" id="add-custom-action-button" disabled>Aktion erstellen</button>
            </form>
            <div id="custom-action-message" class="message"></div>
        </div>
    </div>
    
    <div class="card" style="grid-column: span 3;">
        <h2>Team-Einstellungen & Standard-Fristen</h2>
        <h3><span id="settings-team-name" style="color: #ffcc00;">(Team w√§hlen)</span></h3>
        <p style="font-size: 0.9em; opacity: 0.8;">Definiere die Standard-Stunden vor dem Termin, bis zu denen Spieler antworten m√ºssen. (0 oder leer = keine Frist)</p>
        <form id="update-settings-form">
            <div id="settings-loading-indicator" style="text-align: center; opacity: 0.6; padding: 10px;">Bitte Team ausw√§hlen.</div>
            <div class="settings-grid" id="settings-form-content" style="display: none;">
                
                <div class="form-section active">
                    <label for="setting-game">Saisonspiel (GAME):</label>
                    <input type="number" id="setting-game" min="0" required>
                </div>
                
                <div class="form-section active">
                    <label for="setting-tournament">Turnier (GAME):</label>
                    <input type="number" id="setting-tournament" min="0" required>
                </div>
                
                <div class="form-section active">
                    <label for="setting-testspiel">Testspiel (OTHER):</label>
                    <input type="number" id="setting-testspiel" min="0" required>
                </div>
                
                <div class="form-section active">
                    <label for="setting-training">Training (TRAINING):</label>
                    <input type="number" id="setting-training" min="0" required>
                </div>
                
                <div class="form-section active">
                    <label for="setting-other">Sonstiges (OTHER):</label>
                    <input type="number" id="setting-other" min="0" required>
                </div>
                
            </div>
            <button type="submit" class="btn btn-primary btn-full-width" id="save-settings-btn" style="margin-top: 20px; display: none;" disabled>
                Standard-Fristen speichern
            </button>
        </form>
        <div id="settings-message" class="message"></div>
    </div>
</div>


<div class="card" style="margin-top: 20px; grid-column: span 3;">
    <h2>Meine Mannschaften (Auswahl)</h2>
    <p style="font-size: 0.9em; opacity: 0.8;">Hier w√§hlst du dein Team aus UND verwaltest die √∂ffentliche Sichtbarkeit (f√ºr Liga-Scouting).</p>
    <p id="selected-team-info" style="font-weight: bold; color: #00bcd4;"></p>
    <div id="team-list" style="max-height: 400px; overflow-y: auto; margin-top: 15px;">
        <p style="opacity: 0.6;">Lade Mannschaften...</p>
    </div>
</div>

<div class="card" style="margin-top: 20px; grid-column: span 3;">
    <h2>Trainer & Staff Management</h2>
    <h3><span id="staff-team-name" style="color: #ffcc00;">(Team w√§hlen)</span></h3>
    
    <div id="staff-management-container" class="staff-management-grid">
        
        <div class="card-content">
            <h4 style="color: #00bcd4; margin-top: 0;">Trainer hinzuf√ºgen</h4>
            <p style="font-size: 0.9em; opacity: 0.8;">
                Geben Sie die E-Mail-Adresse des Co-Trainers/Admins ein.
                Der Account muss bereits registriert sein.
            </p>
            <form id="add-coach-form">
                <label for="coach-email">E-Mail des Trainers:</label>
                <input type="email" id="coach-email" required placeholder="trainer@beispiel.de">
                <button type="submit" class="btn btn-info btn-full-width" id="add-coach-button" disabled>
                    Trainer zum Team hinzuf√ºgen
                </button>
            </form>
            <div id="coach-message" class="message"></div>
        </div>

        <div class="card-content">
            <h4 style="color: #00bcd4; margin-top: 0;">Aktuelles Staff</h4>
            <div id="staff-list-container">
                 <p style="opacity: 0.6;">W√§hlen Sie ein Team.</p>
            </div>
            <p style="font-size: 0.8em; opacity: 0.7; margin-top: 15px;">
                *Nur Haupttrainer/Admin kann Rollen √§ndern.
            </p>
        </div>
    </div>
</div>
<div class="card" style="margin-top: 20px; grid-column: span 3;">
    <h2>Kader √úbersicht</h2>
    <h3><span id="kader-team-name" style="color: #ffcc00;">(Team w√§hlen)</span></h3>
    <div id="player-list-container">
        <p style="opacity: 0.6;">W√§hlen Sie eine Mannschaft aus.</p>
    </div>
</div>

<div class="card" style="margin-top: 20px; grid-column: span 3;">
    <h2>Aktions-√úbersicht</h2>
    <h3><span id="custom-action-team-name" style="color: #ffcc00;">(Team w√§hlen)</span></h3>
    <div id="custom-action-list-container">
         <p style="opacity: 0.6;">W√§hlen Sie ein Team.</p>
    </div>
</div>

<!-- MODALE -->

<div id="invite-player-modal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeInviteModal()">&times;</span>
        <h3 id="invite-modal-title">Spieler-Account einladen</h3>
        <p>
            Gib die E-Mail-Adresse des Spielers ein. Er erh√§lt einen Link,
            um seinen Account zu aktivieren und ein Passwort festzulegen.
        </p>
        <div class="form-section active">
            <label for="invite-player-email">E-Mail-Adresse:</label>
            <input type="email" id="invite-player-email" placeholder="spieler@email.com">
        </div>
        <input type="hidden" id="invite-player-id">
        <button class="btn btn-primary btn-full-width" onclick="sendInvitation()">
            Einladung senden
        </button>
        <div id="invite-player-message" class="message"></div>
    </div>
</div>

<div id="role-change-modal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeRoleModal()">&times;</span>
        <h3 id="role-modal-title">Rolle √§ndern: <span id="role-modal-coach-name"></span></h3>
        
        <p style="font-size: 0.9em; opacity: 0.8; margin-top: 5px;">
            W√§hlen Sie die neue Rolle f√ºr diesen Trainer.
            Die Rollen **Haupttrainer** und **Admin** geben volle Management-Rechte.
        </p>

        <div id="role-swap-section">
            <h4 style="color: #ff6666; margin-top: 20px;">‚ö†Ô∏è Rollen-Tausch: Haupttrainer</h4>
            <p>
                Sie sind aktuell der **Haupttrainer**. Wenn Sie die Rolle dieses Trainers auf **Haupttrainer** setzen,
                wird **Ihre Rolle automatisch auf Co-Trainer herabgestuft.**
            </p>
            <label for="new-role-select-swap">Neue Rolle f√ºr <span id="swap-target-name"></span>:</label>
            <select id="new-role-select-swap">
                <option value="MAIN_COACH">Haupttrainer (MAIN_COACH)</option>
                <option value="TEAM_ADMIN">Team-Admin (TEAM_ADMIN)</option>
                <option value="ASSISTANT_COACH">Co-Trainer (ASSISTANT_COACH)</option>
            </select>
            <button class="btn btn-danger btn-full-width" style="margin-top: 10px;" onclick="confirmRoleSwap()">
                Haupttrainer-Rolle tauschen
            </button>
        </div>
        
        <div id="role-update-section">
            <h4 style="color: #00bcd4; margin-top: 20px;">Rolle aktualisieren</h4>
            <label for="new-role-select-update">Neue Rolle f√ºr <span id="update-target-name"></span>:</label>
            <select id="new-role-select-update">
                <option value="TEAM_ADMIN">Team-Admin (TEAM_ADMIN)</option>
                <option value="ASSISTANT_COACH">Co-Trainer (ASSISTANT_COACH)</option>
            </select>
            <button class="btn btn-primary btn-full-width" style="margin-top: 10px;" onclick="confirmRoleUpdate()">
                Rolle festlegen
            </button>
        </div>
        
        <div id="role-modal-message" class="message"></div>
    </div>
</div>

<!-- NEU (PHASE 11): INJURY MANAGEMENT MODAL -->
<div id="injury-modal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeInjuryModal()">&times;</span>
        <h3 style="color: #f44336;">Verletzungs-Akte: <span id="injury-player-name" style="color: #fff;"></span></h3>
        
        <div class="injury-layout">
            <!-- Linke Spalte: Neue Verletzung -->
            <div class="injury-form-column">
                <h4 style="margin-top: 0; color: #ffcc00;">Neue Verletzung eintragen</h4>
                <form id="injury-form">
                    <input type="hidden" id="injury-player-id">
                    
                    <div class="form-section active">
                        <label for="injury-description">Diagnose / Beschreibung:</label>
                        <input type="text" id="injury-description" placeholder="z.B. B√§nderriss Sprunggelenk" required>
                    </div>
                    
                    <div class="form-section active">
                        <label for="injury-location">K√∂rperregion (Optional):</label>
                        <input type="text" id="injury-location" placeholder="z.B. Rechtes Knie">
                    </div>
                    
                    <div class="form-section active">
                        <label for="injury-status">Aktueller Status:</label>
                        <select id="injury-status" required>
                            <option value="ACUTE">üî¥ Akut (F√§llt aus)</option>
                            <option value="REHAB">üü° Reha / Aufbautraining</option>
                            <option value="CHRONIC">üü† Chronisch (Einsatzf√§hig mit Einschr√§nkung)</option>
                            <!-- CLEARED macht beim Neuerstellen wenig Sinn, kann aber sp√§ter gesetzt werden -->
                        </select>
                    </div>
                    
                    <div class="form-section active">
                        <label for="injury-start-date">Beginn (Datum):</label>
                        <input type="date" id="injury-start-date" required>
                    </div>
                    
                    <div class="form-section active">
                        <label for="injury-end-date">Voraussichtliches Ende (Optional):</label>
                        <input type="date" id="injury-end-date">
                    </div>

                    <div class="form-section active">
                        <label for="injury-notes">Notizen (Therapie, Arzt, etc.):</label>
                        <textarea id="injury-notes" rows="3" placeholder="Interne Notizen..."></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-danger btn-full-width">Verletzung speichern</button>
                </form>
                <div id="injury-message" class="message"></div>
            </div>
            
            <!-- Rechte Spalte: Historie -->
            <div class="injury-history-column">
                <h4 style="margin-top: 0; color: #00bcd4;">Verletzungs-Historie</h4>
                <div id="injury-history-list">
                    <p style="opacity: 0.6; text-align: center;">Lade Akte...</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // --- Modale Schlie√üen Events (lokal beibehalten) ---
    const invitePlayerModal = document.getElementById('invite-player-modal');
    const roleChangeModal = document.getElementById('role-change-modal');
    const injuryModal = document.getElementById('injury-modal');

    // MUSS in team_management.js definiert werden
    function closeInviteModal() { invitePlayerModal.style.display = 'none'; }
    function closeRoleModal() { roleChangeModal.style.display = 'none'; }
    function closeInjuryModal() { injuryModal.style.display = 'none'; }

    invitePlayerModal.addEventListener('click', function(event) {
        if (event.target === invitePlayerModal) { closeInviteModal(); }
    });
    roleChangeModal.addEventListener('click', function(event) {
        if (event.target === roleChangeModal) { closeRoleModal(); }
    });
    injuryModal.addEventListener('click', function(event) {
        if (event.target === injuryModal) { closeInjuryModal(); }
    });
</script>
<script src="/static/team_management.js"></script>