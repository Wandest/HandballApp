<style>
    /* * Diese Stile sind 1:1 aus app_layout.html / season_analysis.html kopiert,
     * damit die Wurfbilder und Tabellen im Modal korrekt aussehen.
     */
    .shot-chart-container-half,
    .shot-chart-container-full {
        position: relative; width: 100%;
        background-color: #ffffff; border: 2px solid #000;
        box-sizing: border-box; border-radius: 5px;
        overflow: hidden; margin-top: 15px;
    }
    .shot-chart-container-full {
        /* Im Scouting-Modal wollen wir nur Ganzfeld */
        max-width: 700px;
        margin-left: auto;
        margin-right: auto;
    }
    .svg-handball-pitch {
        width: 100%;
        height: auto;
        display: block;
        z-index: 1; 
    }
    .shot-overlay {
        position: absolute; top: 0; left: 0;
        width: 100%; height: 100%;
        z-index: 2; 
    }
    .shot-overlay p { color: #000; opacity: 0.7; }
    
    .stats-table tfoot tr {
        background-color: rgba(0,0,0,0.3); 
        font-weight: bold; 
        border-top: 2px solid #ffcc00;
    }
    .shot-dot {
        position: absolute; width: 12px; height: 12px;
        border-radius: 50%; transform: translate(-50%, -50%);
        border: 2px solid rgba(0,0,0,0.7);
        box-shadow: 0 1px 3px rgba(0,0,0,0.5);
    }
    .shot-dot.goal { background-color: #38E838; }
    .shot-dot.miss { background-color: #f44336; }
    .shot-dot.tech-error-pass { background-color: #ff9800; }
    .shot-dot.opp-goal { background-color: #9E9E9E; }
    .shot-dot.opp-miss { background-color: #795548; }
    
    .shot-chart-legend {
        display: flex; justify-content: center;
        gap: 20px; margin-top: 15px;
        color: white; /* Legenden-Text im Modal ist weiß */
    }
    .legend-item { display: flex; align-items: center; }
    .legend-color-box {
        width: 15px; height: 15px;
        margin-right: 8px; border: 1px solid rgba(255,255,255,0.5);
        border-radius: 3px;
    }
    .legend-color-box.goal { background-color: #38E838; }
    .legend-color-box.miss { background-color: #f44336; }
    .legend-color-box.tech-error-pass { background-color: #ff9800; }
    .legend-color-box.opp-goal { background-color: #9E9E9E; }
    .legend-color-box.opp-miss { background-color: #795548; }
    
    /* ================================================== */
    /* (PHASE 9): Stile für Scouting-Berichte */
    /* ================================================== */
    #scouting-reports-list {
        margin-top: 15px;
        max-height: 300px;
        overflow-y: auto;
    }
    .report-item {
        background: rgba(0, 0, 0, 0.2);
        padding: 12px 15px;
        border-radius: 5px;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .report-item-info strong {
        display: block;
        font-size: 1.1em;
        color: #fff;
    }
    .report-item-info span {
        font-size: 0.9em;
        opacity: 0.7;
    }
    .report-item-actions .btn {
        margin-top: 0;
        margin-left: 10px;
        padding: 5px 10px;
        font-size: 0.9em;
    }
    
    /* Stile für das Editor-Modal */
    #report-editor-modal .modal-content {
        max-width: 800px; /* Breiter für Text-Editor */
    }
    #report-editor-modal textarea {
        width: 100%;
        box-sizing: border-box;
        padding: 10px;
        font-family: system-ui, sans-serif;
        font-size: 1em;
        border-radius: 5px;
        border: 1px solid #ccc;
        background: #f0f0f0;
        color: #333;
        resize: vertical; /* Erlaube Größenänderung in der Höhe */
    }
</style>

<div class="analysis-grid-1-col">
    <div class="card">
        <div class="card-content">
            <h2>Liga-Scouting</h2>
            <label for="public-league-select">Öffentliche Liga auswählen:</label>
            <select id="public-league-select" onchange="loadPublicTeams(this.value)">
                <option value="" disabled selected>Lade Ligen...</option>
            </select>
            <p style="font-weight: bold; margin-top: 10px; color: #ffcc00;">Teams in dieser Liga:</p>
            <div id="public-teams-list" style="max-height: 400px; overflow-y: auto;">
                <p style="opacity: 0.6;">Bitte eine Liga auswählen.</p>
            </div>
        </div>
    </div>
</div>

<div id="scouting-modal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal()">&times;</span>
        <h2 id="scouting-team-name" style="color: #38E838;"></h2>
        <p style="opacity: 0.8; margin-bottom: 20px;">Aggregierte Saison-Statistik (Öffentlich)</p>

        <div class="card" style="background: #1a335c; padding: 10px; margin-bottom: 15px;">
            <div class="card-content">
                <h3 style="margin-top: 0px;">Gegner-Statistik (Saison)</h3>
                <div id="public-stats-table-opponent-season">
                    <p style="opacity: 0.6; text-align: center;">Lade Statistik...</p>
                </div>
            </div>
        </div>

        <div class="card" style="background: #1a335c; padding: 10px; margin-bottom: 15px;">
            <div class="card-content">
                <h3 style="margin-top: 0px;">Feldspieler-Statistik</h3>
                <div class="stats-table-container" id="public-stats-table-field-season">
                    <p style="opacity: 0.6; text-align: center;">Lade Statistik...</p>
                </div>
            </div>
        </div>
        
        <div class="card" style="background: #1a335c; padding: 10px; margin-bottom: 15px;">
            <div class="card-content">
                <h3 style="margin-top: 0px;">Torwart-Statistik</h3>
                <div class="stats-table-container" id="public-stats-table-goalie-season"></div>
            </div>
        </div>

        <div class="card" style="background: #1a335c; padding: 10px; margin-bottom: 15px;">
            <div class="card-content">
                <h3 style="margin-top: 0px;">Team-Aktionen Statistik</h3>
                <div class="stats-table-container" id="public-stats-table-custom-season"></div>
            </div>
        </div>
        
        <hr style="border-color: rgba(255,255,255,0.2); margin: 30px 0;">
        <h2 style="color: #38E838;">Wurf-Analyse (Öffentlich)</h2>

        <div class="card" style="margin-top: 20px; background: #1a335c; padding: 10px;">
            <div class="card-content">
                <h3 style="color: #ffcc00;">Eigenes Wurfbild (Team)</h3>
                <label for="public-shot-chart-player-select">Spieler auswählen:</label>
                <select id="public-shot-chart-player-select">
                    <option value="all" selected>Alle Spieler</option>
                </select>
                <div class="shot-chart-container-full">
                    <img src="/static/halbfeld_links.svg" class="svg-handball-pitch" alt="Handball-Halbfeld">
                    <div class="shot-overlay" id="public-shot-chart-overlay"></div>
                </div>
                <div class="shot-chart-legend">
                    <div class="legend-item"><span class="legend-color-box goal"></span> <span>Tor</span></div>
                    <div class="legend-item"><span class="legend-color-box miss"></span> <span>Fehlwurf</span></div>
                </div>
            </div>
        </div>
        
        <div class="card" style="margin-top: 20px; background: #1a335c; padding: 10px;">
            <div class="card-content">
                <h3 style="color: #ffcc00;">Eigenes Fehlerbild (Team)</h3>
                <label for="public-error-chart-player-select">Spieler auswählen:</label>
                <select id="public-error-chart-player-select">
                    <option value="all" selected>Alle Spieler</option>
                </select>
                <div class="shot-chart-container-full">
                    <img src="/static/ganzfeld.svg" class="svg-handball-pitch" alt="Handball-Ganzfeld">
                    <div class="shot-overlay" id="public-error-chart-overlay"></div>
                </div>
                <div class="shot-chart-legend">
                    <div class="legend-item"><span class="legend-color-box miss"></span> <span>Tech. Fehler</span></div>
                    <div class="legend-item"><span class="legend-color-box tech-error-pass"></span> <span>Fehlpass</span></div>
                </div>
            </div>
        </div>

        <div class="card" style="margin-top: 20px; background: #1a335c; padding: 10px;">
            <div class="card-content">
                <h3 style="color: #ffcc00;">Gegner Wurfbild (Team)</h3>
                <div class="shot-chart-container-full">
                    <img src="/static/halbfeld_links.svg" class="svg-handball-pitch" alt="Handball-Halbfeld">
                    <div class="shot-overlay" id="public-opponent-shot-chart-overlay"></div>
                </div>
                <div class="shot-chart-legend">
                    <div class="legend-item"><span class="legend-color-box opp-goal"></span> <span>Gegner Tor</span></div>
                    <div class="legend-item"><span class="legend-color-box opp-miss"></span> <span>Gegner Fehlwurf</span></div>
                </div>
            </div>
        </div>
        
        <hr style="border-color: rgba(255,255,255,0.2); margin: 30px 0;">
        <h2 style="color: #38E838;">Qualitative Scouting-Berichte (Meine Notizen)</h2>
        
        <input type="hidden" id="scouting-modal-opponent-name">
        <input type="hidden" id="scouting-modal-my-team-id">

        <button class="btn btn-primary" onclick="openReportEditor(null)">
            Neuen Bericht für diesen Gegner schreiben
        </button>
        
        <div id="scouting-reports-list">
            <p style="opacity: 0.6; margin-top: 15px;">Lade Berichte...</p>
        </div>
        </div>
</div>

<div id="report-editor-modal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeReportEditor()">&times;</span>
        <h3 id="report-editor-title">Scouting-Bericht</h3>
        
        <div class="form-section active">
            <label for="report-title">Titel:</label>
            <input type="text" id="report-title" placeholder="z.B. Abwehr-Analyse vs. 6-0">
        </div>
        
        <div class="form-section active">
            <label for="report-opponent">Gegner (Teamname):</label>
            <input type="text" id="report-opponent" disabled style="background: #ccc;">
        </div>
        
        <div class="form-section active">
            <label for="report-game-select">Zugehöriges Spiel (Optional):</label>
            <select id="report-game-select">
                <option value="">Kein spezifisches Spiel</option>
                </select>
        </div>
        
        <div class="form-section active">
            <label for="report-content">Inhalt (Notizen):</label>
            <textarea id="report-content" rows="12" placeholder="Qualitative Notizen..."></textarea>
        </div>
        
        <input type="hidden" id="report-editor-report-id">
        <button class="btn btn-primary btn-full-width" onclick="saveReport()">
            Bericht speichern
        </button>
        <div id="report-editor-message" class="message"></div>
    </div>
</div>

<script>
    // --- Modale Schließen Events (lokal beibehalten) ---
    const scoutingModal = document.getElementById('scouting-modal');
    const reportEditorModal = document.getElementById('report-editor-modal');

    // MUSS in league_scouting.js definiert werden
    function closeModal() { scoutingModal.style.display = 'none'; }
    function closeReportEditor() { reportEditorModal.style.display = 'none'; }

    scoutingModal.addEventListener('click', function(event) {
        if (event.target === scoutingModal) { closeModal(); }
    });
    
    reportEditorModal.addEventListener('click', function(event) {
        if (event.target === reportEditorModal) { closeReportEditor(); }
    });
</script>
<script src="/static/season_analysis.js"></script>
<script src="/static/league_scouting.js"></script>