<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>{{ title }}</title>
    <style>
        /* ... (Alle deine CSS-Stile bleiben unver√§ndert) ... */
        body {
            font-family: system-ui, sans-serif;
            background: linear-gradient(120deg, #1e3c72, #2a5298);
            color: white;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
        }
        .sidebar {
            width: 250px;
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }
        .sidebar h2 {
            color: #ffcc00;
            margin-top: 0;
            text-align: center;
        }
        .sidebar a {
            text-decoration: none;
            color: white;
            padding: 12px 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            transition: background-color 0.2s;
            font-weight: bold;
            display: block;
            font-size: 1.1em;
        }
        .sidebar a:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .sidebar a.active {
            background: #00bcd4;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        .main-content {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            position: relative; 
        }
        
        .verification-banner {
            background-color: #ffcc00;
            color: #1e3c72;
            padding: 15px 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            display: none; /* Standardm√§√üig versteckt */
            align-items: center;
            justify-content: space-between;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            font-size: 1em;
        }
        .verification-banner.visible {
            display: flex; /* Wird per JS sichtbar gemacht */
        }
        .verification-banner .btn-refresh {
            background-color: #1e3c72;
            color: #ffcc00;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin-left: 20px;
            transition: background-color 0.2s, transform 0.1s;
        }
        .verification-banner .btn-refresh:hover {
            background-color: #2a5298;
            transform: translateY(-1px);
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 20px;
        }
        .header-bar h1 {
            margin: 0;
            font-size: 2em;
            color: #ffcc00;
        }
        .greeting {
            font-size: 1em;
        }
        .btn-logout {
            background: #ff6666; 
            color: white; 
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s;
        }
        .btn-logout:hover {
            background: #d32f2f;
        }
        
        /* Grid-Layout f√ºr die Inhaltsseiten */
        .management-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }
        .dashboard-grid {
             display: grid;
             grid-template-columns: 1fr 2fr; /* Neu */
             gap: 20px;
        }
        .card-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        /* +++ NEUES GRID F√úR KALENDER +++ */
        .calendar-layout {
            display: grid;
            grid-template-columns: 1fr 2fr; /* 1/3 f√ºr Erstellung, 2/3 f√ºr Liste */
            gap: 20px;
        }
        
        .analysis-grid, .analysis-grid-1-col {
             display: grid;
            grid-template-columns: 1fr; 
            gap: 20px;
        }
        .analysis-grid-2-col {
             display: grid;
            grid-template-columns: 2fr 1fr; 
            gap: 20px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.15);
            padding: 20px;
            border-radius: 10px;
            text-align: left;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        
        /* Allgemeine UI-Elemente f√ºr alle Seiten */
        h2 { color: #fff; margin-top: 0; margin-bottom: 15px; }
        h3 { color: #ffcc00; margin-top: 0; margin-bottom: 10px; }
        .message { margin-top: 10px; font-weight: bold; }
        .success { color: #38E838; }
        .error { color: #FF6666; }
        
        input[type="text"], input[type="number"], input[type="datetime-local"], input[type="date"], select, textarea {
          width: 100%;
          padding: 10px;
          margin-bottom: 10px;
          border-radius: 5px;
          border: 1px solid #ccc;
          box-sizing: border-box;
          background: #f0f0f0;
          color: #333;
          font-size: 1em;
        }
        /* Korrektur f√ºr Textarea */
        textarea {
            font-family: system-ui, sans-serif;
            resize: vertical;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .btn {
            padding: 12px 15px;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            font-size: 1em;
            color: white;
            transition: background-color 0.2s, transform 0.1s, box-shadow 0.2s;
            margin-top: 10px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            box-sizing: border-box;
        }
        .btn.btn-full-width {
            width: 100%;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .btn:active:not(:disabled) {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }
        .btn-primary { background: #38E838; color: #1e3c72; }
        .btn-primary:hover:not(:disabled) { background: #50f050; }
        
        .btn-danger { background-color: #f44336; color: white; }
        .btn-danger:hover:not(:disabled) { background-color: #d32f2f; }
        
        .btn-info { background-color: #00bcd4; color: white; }
        .btn-info:hover:not(:disabled) { background-color: #0097a7; }
        
        .btn-secondary { background-color: #607d8b; color: white; }
        .btn-secondary:hover:not(:disabled) { background-color: #78909c; }
        
        .btn-inline {
            width: auto; 
            padding: 8px 12px;
            font-size: 0.9em;
            margin: 0 5px;
        }
        
        .btn-inline-delete {
            width: auto;
            padding: 6px 10px;
            font-size: 0.85em;
            margin-left: 10px;
            flex-shrink: 0;
            margin-top: 0; /* √úberschreibt .btn margin-top */
        }
        
        
        /* Styles f√ºr Listen (Team-Management) */
        .team-list-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px; margin-bottom: 8px; border-radius: 4px;
            display: flex; flex-direction: column;
            justify-content: space-between; align-items: flex-start;
            cursor: pointer; transition: background-color 0.2s;
        }
        .team-list-item.selected {
            background: #ffcc00; color: #1e3c72; font-weight: bold;
            box-shadow: 0 0 10px rgba(255, 204, 0, 0.5);
        }
        .team-list-item:hover:not(.selected) {
            background: rgba(255, 255, 255, 0.2);
        }
        .team-info-line {
            display: flex; justify-content: space-between; width: 100%;
        }
        .team-public-control {
            margin-top: 10px; font-size: 0.9em;
            display: flex; align-items: center;
        }
        .team-public-control input {
            width: auto; margin: 0 10px 0 0;
        }
        
        .player-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0,0,0,0.2);
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 5px;
        }
        .player-list-item span {
            font-size: 1.1em;
        }
        .player-list-item .btn-danger {
            width: auto; 
            padding: 5px 10px; 
            font-size: 0.85em; 
            margin-top: 0; 
        }
        
        .custom-action-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0,0,0,0.2);
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 5px;
        }
        .custom-action-list-item .btn-danger {
            width: auto; 
            padding: 5px 10px; 
            font-size: 0.85em; 
            margin-top: 0; 
        }
        
        /* Spielplan-Liste */
        .game-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0,0,0,0.2);
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 8px;
        }
        .game-info {
            display: flex;
            flex-direction: column;
        }
        .game-info span:first-child {
            font-weight: bold;
            font-size: 1.1em;
        }
        .game-info span:last-child {
            font-size: 0.9em;
            opacity: 0.8;
        }
        .game-actions {
            flex-shrink: 0;
            margin-left: 10px;
        }
        
        /* Liga-Scouting Stile */
        .league-team-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 16px;
            margin-bottom: 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
            text-align: center; 
            font-size: 1.2em;
            font-weight: bold;
        }
        .league-team-item:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        .league-team-item strong {
            color: #fff;
            font-weight: bold;
        }
        
        /* Styles f√ºr Tabellen (Statistiken) */
        .stats-table-container {
            width: 100%;
            overflow-x: auto;
        }
        .stats-table {
            width: 100%;
            min-width: 600px; 
            border-collapse: collapse;
            margin-top: 15px;
        }
        .stats-table th, .stats-table td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .stats-table th {
            color: #ffcc00;
            border-bottom: 2px solid #ffcc00;
            font-size: 0.9em;
            text-transform: uppercase;
        }
        .stats-table td:first-child, .stats-table th:first-child { text-align: left; }
        
        .opponent-stats-table {
            width: 100%; max-width: 400px;
            margin-top: 15px;
        }
        .opponent-stats-table td {
             padding: 10px;
             border-bottom: 1px solid rgba(255, 255, 255, 0.1);
             font-size: 1.1em;
        }
        .opponent-stats-table td:first-child {
            font-weight: bold;
            width: 80%;
        }
        .opponent-stats-table td:last-child {
            text-align: center;
            font-weight: bold;
            font-size: 1.2em;
        }
        
        /* Modal Styles */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 1000; 
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.7); 
        }
        .modal-content {
            background-color: #1e3c72;
            margin: 5% auto; 
            padding: 30px;
            border-radius: 10px;
            width: 80%; 
            max-width: 900px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            max-height: 80vh;
            overflow-y: auto;
        }
        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close-btn:hover, .close-btn:focus {
            color: white;
            text-decoration: none;
            cursor: pointer;
        }
        
        /* Toast-Nachrichten */
        .toast {
            visibility: hidden;
            min-width: 250px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 5px;
            padding: 16px;
            position: fixed;
            z-index: 1001;
            left: 50%;
            transform: translateX(-50%);
            bottom: 30px;
            font-size: 1em;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }
        .toast.show {
            visibility: visible;
            animation: fadein 0.5s, fadeout 0.5s 2.5s;
        }
        .toast.error { background-color: #f44336; }
        .toast.success { background-color: #38E838; color: #1e3c72; }

        @keyframes fadein {
            from {bottom: 0; opacity: 0;}
            to {bottom: 30px; opacity: 1;}
        }
        @keyframes fadeout {
            from {bottom: 30px; opacity: 1;}
            to {bottom: 0; opacity: 0;}
        }
        
        /* Tab-Buttons (z.B. Spiel anlegen) */
        .game-category-tabs {
            display: flex;
            margin-bottom: 20px;
        }
        .tab-button {
            flex-grow: 1;
            padding: 10px 15px;
            cursor: pointer;
            background: rgba(0,0,0,0.3);
            border: none;
            color: white;
            font-weight: bold;
            opacity: 0.7;
            font-size: 1.0em;
            transition: background-color 0.2s, opacity 0.2s;
            border-bottom: 3px solid rgba(255,255,255,0.2);
        }
        .tab-button:hover:not(:disabled) {
            opacity: 1;
            background: rgba(255, 255, 255, 0.1);
        }
        .tab-button.active {
            opacity: 1;
            color: #ffcc00;
            border-bottom: 3px solid #ffcc00;
        }
        .tab-button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        .form-section {
            display: none;
        }
        .form-section.active {
            display: block;
        }
        
        /* ================================================== */
        /* CSS F√úR SHOT CHARTS (GLOBAL) */
        /* ================================================== */
        .shot-chart-container-half,
        .shot-chart-container-full {
            position: relative;
            width: 100%;
            background-color: #ffffff;
            border: 2px solid #000;
            box-sizing: border-box;
            border-radius: 5px;
            overflow: hidden; 
            margin-top: 15px;
        }
        .shot-chart-container-half {
            max-width: 450px; 
            margin-left: auto;
            margin-right: auto;
        }
        .shot-chart-container-full {
            max-width: 700px; 
            margin-left: auto;
            margin-right: auto;
        }
        .svg-handball-pitch {
            width: 100%;
            height: auto; 
            display: block; 
            z-index: 1; 
        }
        .shot-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2; 
        }
        /* Text im Overlay (z.B. "Keine Wurfdaten") auf schwarz */
        .shot-overlay p {
            color: #000000;
            opacity: 0.7;
            text-align: center;
        }
        .shot-dot {
            position: absolute; width: 12px; height: 12px;
            border-radius: 50%; transform: translate(-50%, -50%);
            border: 2px solid rgba(0,0,0,0.7);
            box-shadow: 0 1px 3px rgba(0,0,0,0.5);
        }
        .shot-dot.goal { background-color: #38E838; }
        .shot-dot.miss { background-color: #f44336; }
        .shot-dot.tech-error-pass { background-color: #ff9800; }
        .shot-dot.opp-goal { background-color: #9E9E9E; }
        .shot-dot.opp-miss { background-color: #795548; }

        .shot-chart-legend {
            display: flex; justify-content: center;
            gap: 20px; margin-top: 15px;
            color: white; /* Legenden-Text ist wei√ü */
        }
        .legend-item { display: flex; align-items: center; }
        .legend-color-box {
            width: 15px; height: 15px;
            margin-right: 8px; border: 1px solid rgba(255,255,255,0.5);
            border-radius: 3px;
        }
        .legend-color-box.goal { background-color: #38E838; }
        .legend-color-box.miss { background-color: #f44336; }
        .legend-color-box.tech-error-pass { background-color: #ff9800; }
        .legend-color-box.opp-goal { background-color: #9E9E9E; }
        .legend-color-box.opp-miss { background-color: #795548; }
        
    </style>
</head>
<body>
    
    <div class="sidebar">
        <h2>HandballApp</h2>
        
        {% if user_type == "trainer" %}
             <a id="nav-dashboard" href="/dashboard" class="nav-link">üè† Dashboard</a>
        {% elif user_type == "player" %}
             <a id="nav-player-dashboard" href="/player-dashboard" class="nav-link">üè† Mein Portal</a>
        {% endif %}

        <!-- KORREKTUR: Navigationsstruktur f√ºr Spieler getrennt -->
        {% if user_type == "trainer" %}
            <a id="nav-calendar" href="/calendar" class="nav-link">üóìÔ∏è Kalender</a>
            <a id="nav-team" href="/team-management" class="nav-link">üèüÔ∏è Team Management</a>
            <a id="nav-planning" href="/game-planning" class="nav-link">üìÖ Spielplanung</a>
            
            <a id="nav-analysis" href="/season-analysis" class="nav-link">üìä Saison Analyse</a>
            <a id="nav-scouting" href="/league-scouting" class="nav-link">üî≠ Liga Scouting</a>
        
        {% elif user_type == "player" %}
            <!-- NEU: Separater Link f√ºr alle Termine -->
            <a id="nav-calendar" href="/player-calendar" class="nav-link">üóìÔ∏è Alle Termine</a>
        {% endif %}
        <div style="flex-grow: 1;"></div> 

        <button onclick="logout()" class="btn-logout">Logout</button>
        
        <p style="text-align: center; font-size: 0.8em; opacity: 0.7; margin-top: 15px;">Angemeldet als: {{ display_name }}</p>
    </div>

    <div class="main-content">
        
        {% if user_type == "trainer" %}
        <div id="verification-banner" class="verification-banner">
            <span>
                ‚ö†Ô∏è Dein Konto ist nicht verifiziert. Bitte √ºberpr√ºfe dein E-Mail-Postfach (ggf. Spam).
            </span>
            <button class="btn-refresh" onclick="location.reload()">
                Refresh
            </button>
        </div>
        {% endif %}

        <div class="header-bar">
            <h1>{{ title }}</h1>
        </div>

        <script src="/static/global.js"></script> 
        
        <div id="page-content">
             {# Hier wird der Inhalt der spezifischen Seite eingef√ºgt #}
             {% include page_content_template %}
        </div>
    </div>

    <div id="toast-message" class="toast"></div>

    <script>
        // --- Globale Jinja2 Variablen in JS / Local Storage speichern ---
        
        {% if user_type == "trainer" %}
            const isVerified = {{ is_verified | tojson }};
            localStorage.setItem('is_verified', isVerified); 
            
            if (!isVerified) {
                document.getElementById('verification-banner').classList.add('visible');
            }
        {% else %}
            // Spieler sind per Definition verifiziert (is_active = true)
            localStorage.setItem('is_verified', 'true'); 
        {% endif %}
        
        // F√ºgt user_type zum Local Storage hinzu, um JS-Logik zu steuern
        localStorage.setItem('logged_in_user_type', '{{ user_type }}');
        
        // KORREKTUR: Navigations-Active-State setzen, damit der richtige Link blau wird
        document.addEventListener('DOMContentLoaded', function() {
            const currentPath = window.location.pathname;
            const navLinks = document.querySelectorAll('.sidebar a.nav-link');
            
            navLinks.forEach(link => {
                link.classList.remove('active');
                
                // Exakte √úbereinstimmung f√ºr die Aktivierung (z.B. /dashboard, /player-dashboard)
                if (link.getAttribute('href') === currentPath) {
                    link.classList.add('active');
                }
            });
            
            // Sonderfall: Wenn man auf der Protokoll-Seite ist, den Game Planning Link als aktiv markieren (falls vorhanden)
            if (currentPath.startsWith('/protocol/')) {
                 const planningLink = document.getElementById('nav-planning');
                 if (planningLink) {
                      planningLink.classList.add('active');
                 }
            }
        });
        // --- ENDE KORREKTUR ---
    </script>
    
    </body>
</html>